# AFC Hardware Configuration for ACE System
#
# This file contains configuration for:
# - Extruder (toolhead) sensors
# - Buffer/TurtleNeck (optional)
#
# Include this file in your printer.cfg after AFC_ACE_1.cfg

# ============================================
# Extruder Configuration
# ============================================
# The extruder section defines sensors in the toolhead
# These sensors detect when filament enters/exits the extruder

[AFC_extruder extruder]
# Sensor before extruder gears (tool start sensor)
pin_tool_start: ^!<toolhead_sensor_start_pin>
# Sensor after extruder gears (tool end sensor)
pin_tool_end: ^!<toolhead_sensor_end_pin>

# Distance from tool end sensor to nozzle tip (mm)
tool_stn: 45

# Loading speeds
tool_load_speed: 10                     # Speed when loading into extruder (mm/s)
tool_unload_speed: 10                   # Speed when unloading from extruder (mm/s)

# Enable sensor visibility in GUI
enable_sensors_in_gui: True

# ============================================
# Buffer Configuration (Optional)
# ============================================
# The buffer (TurtleNeck) manages filament slack between
# the AFC system and the toolhead during printing.
# Comment out this section if not using a buffer.

[AFC_buffer TurtleNeck]
# Advance sensor - triggers when buffer needs more filament
advance_pin: ^!<buffer_advance_pin>
# Trailing sensor - triggers when buffer has too much filament
trailing_pin: ^!<buffer_trailing_pin>

# Buffer response multipliers
multiplier_high: 1.05                   # Speed multiplier when buffer needs more filament
multiplier_low: 0.95                    # Speed multiplier when buffer has too much filament

# Distance thresholds
advance_move_dis: 10                    # Distance to feed when advance triggered (mm)
trailing_move_dis: 10                   # Distance to retract when trailing triggered (mm)

# Enable sensor visibility in GUI
enable_sensors_in_gui: True

# ============================================
# Example Pinout (replace with your actual pins)
# ============================================
# For toolhead connected via CAN:
# [AFC_extruder extruder]
# pin_tool_start: ^!toolhead:PB7
# pin_tool_end: ^!toolhead:PB8
#
# For buffer sensors on main MCU:
# [AFC_buffer TurtleNeck]
# advance_pin: ^!ACE_MCU:SPARE1
# trailing_pin: ^!ACE_MCU:SPARE2

# ============================================
# Notes on Setup
# ============================================
# 1. Tool sensors:
#    - pin_tool_start should trigger when filament first enters the toolhead
#    - pin_tool_end should trigger when filament reaches the extruder gears
#    - Adjust tool_stn to match your hotend geometry
#
# 2. Buffer sensors (if used):
#    - advance_pin triggers when buffer expands (needs more filament)
#    - trailing_pin triggers when buffer compresses (has excess filament)
#    - Tune multipliers to maintain consistent buffer tension during printing
#
# 3. Sensor polarity:
#    - Use ^! for pullup with inverted logic
#    - Use ^ for pullup without inversion
#    - Adjust based on your sensor type (optical, mechanical, etc.)
